<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>Library Dashboard</h1>
    
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <mat-progress-spinner diameter="50" mode="indeterminate"></mat-progress-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <button mat-button color="primary" (click)="loadDashboardData()">
      <mat-icon>refresh</mat-icon>
      Retry
    </button>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading && !error" class="dashboard-content">
    <!-- Statistics Cards -->
    <div class="stats-grid">
      <!-- Books Statistics -->
      <mat-card class="stat-card books-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon">book</mat-icon>
            <span class="stat-title">Books</span>
          </div>
          <div class="stat-numbers">
            <div class="main-number">{{ stats.totalBooks }}</div>
            <div class="sub-number">{{ stats.availableBooks }} available</div>
          </div>
          <div class="stat-progress">
            <mat-progress-bar 
              mode="determinate" 
              [value]="getBooksAvailabilityPercentage()"
              color="primary">
            </mat-progress-bar>
            <span class="progress-text">{{ getBooksAvailabilityPercentage() }}% available</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Users Statistics -->
      <mat-card class="stat-card users-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon">people</mat-icon>
            <span class="stat-title">Users</span>
          </div>
          <div class="stat-numbers">
            <div class="main-number">{{ stats.totalUsers }}</div>
            <div class="sub-number">{{ stats.activeUsers }} active</div>
          </div>
          <div class="stat-progress">
            <mat-progress-bar 
              mode="determinate" 
              [value]="getUsersActivePercentage()"
              color="accent">
            </mat-progress-bar>
            <span class="progress-text">{{ getUsersActivePercentage() }}% active</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Currently Borrowed -->
      <mat-card class="stat-card borrowed-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon">assignment</mat-icon>
            <span class="stat-title">Currently Borrowed</span>
          </div>
          <div class="stat-numbers">
            <div class="main-number">{{ stats.currentlyBorrowed }}</div>
            <div class="sub-number">books out</div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Overdue Books -->
      <mat-card class="stat-card overdue-card">
        <mat-card-content>
          <div class="stat-header">
            <mat-icon class="stat-icon" color="warn">warning</mat-icon>
            <span class="stat-title">Overdue Books</span>
          </div>
          <div class="stat-numbers">
            <div class="main-number overdue-number">{{ stats.overdueBooks }}</div>
            <div class="sub-number">need attention</div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Alert Sections -->
    <div class="alerts-section">
      <!-- Books Due Today -->
      <mat-card class="alert-card" *ngIf="booksDueToday.length > 0">
        <mat-card-header>
          <mat-card-title>
            <mat-icon color="accent">today</mat-icon>
            Books Due Today ({{ booksDueToday.length }})
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="alert-list">
            <div *ngFor="let record of booksDueToday" class="alert-item">
              <div class="item-info">
                <span class="book-title">{{ record.book.title }}</span>
                <span class="user-name">{{ record.user.firstName }} {{ record.user.lastName }}</span>
              </div>
              <div class="item-date">Due: {{ formatDate(record.dueDate) }}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Overdue Books -->
      <mat-card class="alert-card overdue-alert" *ngIf="overdueRecords.length > 0">
        <mat-card-header>
          <mat-card-title>
            <mat-icon color="warn">warning</mat-icon>
            Overdue Books ({{ overdueRecords.length }})
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="alert-list">
            <div *ngFor="let record of overdueRecords" class="alert-item overdue-item">
              <div class="item-info">
                <span class="book-title">{{ record.book.title }}</span>
                <span class="user-name">{{ record.user.firstName }} {{ record.user.lastName }}</span>
              </div>
              <div class="item-details">
                <div class="item-date">Due: {{ formatDate(record.dueDate) }}</div>
                <div class="fine-amount" *ngIf="record.fineAmount > 0">
                  Fine: ${{ record.fineAmount }}
                </div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- No Alerts Message -->
    <mat-card *ngIf="booksDueToday.length === 0 && overdueRecords.length === 0" class="no-alerts-card">
      <mat-card-content>
        <div class="no-alerts-content">
          <mat-icon color="primary" class="large-icon">check_circle</mat-icon>
          <h3>All Good!</h3>
          <p>No books due today and no overdue items.</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
